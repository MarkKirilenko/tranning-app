# models.py
import json
from datetime import datetime
from sqlalchemy import create_engine, Column, Integer, String, DateTime, ForeignKey, Text
from sqlalchemy.orm import sessionmaker, relationship
from sqlalchemy.ext.declarative import declarative_base

# --- SQLAlchemy Setup ---
DATABASE_URL = "sqlite:///fitness_app.db"
Base = declarative_base()

# 1. –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
class User(Base):
    __tablename__ = 'users'
    id = Column(Integer, primary_key=True)
    username = Column(String, unique=True, nullable=False)
    password = Column(String, nullable=False) 
    phone = Column(String)
    dob = Column(String)
    progress = relationship("Progress", back_populates="user", cascade="all, delete-orphan")
    plans = relationship("TrainingPlan", back_populates="user", cascade="all, delete-orphan")
    saved_plans = relationship("SavedPlan", back_populates="user", cascade="all, delete-orphan")
    workout_history = relationship("WorkoutHistory", back_populates="user", cascade="all, delete-orphan")
    
    def __repr__(self): return f"<User('{self.username}')>"

# 2. –ú–æ–¥–µ–ª—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
class Progress(Base):
    __tablename__ = 'progress'
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.id'), nullable=False)
    exercise_name = Column(String, nullable=False)
    timestamp = Column(DateTime, default=datetime.utcnow)
    user = relationship("User", back_populates="progress")

# 3. –ú–æ–¥–µ–ª—å –ø–ª–∞–Ω–∞
class TrainingPlan(Base):
    __tablename__ = 'training_plans'
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.id'), nullable=False)
    level = Column(String, nullable=False)      
    goal = Column(String, nullable=False)       
    condition = Column(String, nullable=False)  
    user = relationship("User", back_populates="plans")

# 4. –ú–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤
class SavedPlan(Base):
    __tablename__ = 'saved_plans'
    
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.id'), nullable=False)
    plan_name = Column(String, nullable=False)
    level = Column(String, nullable=False)
    goal = Column(String, nullable=False)
    condition = Column(String, nullable=False)
    exercises = Column(String, nullable=False)  # JSON —Å—Ç—Ä–æ–∫–∞ —Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏
    created_at = Column(DateTime, default=datetime.utcnow)
    
    user = relationship("User", back_populates="saved_plans")

# 5. –ú–æ–¥–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
class WorkoutHistory(Base):
    __tablename__ = 'workout_history'
    
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.id'), nullable=False)
    workout_name = Column(String, nullable=False)
    exercises = Column(Text, nullable=False)  # JSON —Å—Ç—Ä–æ–∫–∞ —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏
    duration = Column(Integer)  # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–Ω—É—Ç–∞—Ö
    completed_at = Column(DateTime, default=datetime.utcnow)
    
    user = relationship("User", back_populates="workout_history")

class DatabaseManager:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–∏–ª–µ Nike Training Club."""
    def __init__(self, db_url=DATABASE_URL):
        self.engine = create_engine(db_url)
        Base.metadata.create_all(self.engine)
        self.Session = sessionmaker(bind=self.engine)
        
        # --- –ë–ê–ó–ê –¢–†–ï–ù–ò–†–û–í–û–ö –í –°–¢–ò–õ–ï NIKE TRAINING CLUB ---
        self.exercises = {
            "–ù–æ–≤–∏—á–æ–∫": {
                "–ü–æ—Ö—É–¥–µ–Ω–∏–µ": {
                    "–î–æ–º": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –°—É—Å—Ç–∞–≤–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞ (2 –º–∏–Ω)",
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –ë–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ —Å –≤—ã—Å–æ–∫–∏–º –±–µ–¥—Ä–æ–º (1 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –≤–µ—Å–æ–º —Ç–µ–ª–∞ (3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –∫–æ–ª–µ–Ω (3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –í—ã–ø–∞–¥—ã –Ω–∞ –º–µ—Å—Ç–µ (3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –Ω–∞ –Ω–æ–≥—É)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–ª–∞–Ω–∫–∞ (3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 30 —Å–µ–∫—É–Ω–¥)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è (3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –†–∞—Å—Ç—è–∂–∫–∞ –≤—Å–µ–≥–æ —Ç–µ–ª–∞ (5 –º–∏–Ω)"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –≠–ª–ª–∏–ø—Å–æ–∏–¥ –ª–µ–≥–∫–∏–π —Ç–µ–º–ø (5 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ñ–∏–º –Ω–æ–≥–∞–º–∏ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ (3x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏ (3x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π —Å–∏–¥—è (3x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –†–∞–∑–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ (3x15)",
                        "üî¥ –ö–ê–†–î–ò–û-–§–ò–ù–ò–®–ï–†: –ì—Ä–µ–±–Ω–æ–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä (3 –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø–æ 30 —Å–µ–∫)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –†–∞—Å—Ç—è–∂–∫–∞ –∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å–∞ —É —Å—Ç–µ–Ω—ã"
                    ]
                },
                "–ù–∞–±–æ—Ä –º—ã—à—Ü": {
                    "–î–æ–º": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –í—Ä–∞—â–µ–Ω–∏—è —Ä—É–∫–∞–º–∏ –∏ –Ω–∞–∫–ª–æ–Ω—ã (3 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è (4 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ –º–∞–∫—Å–∏–º—É–º—É)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ë–æ–ª–≥–∞—Ä—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã (—Å–æ —Å—Ç—É–ª–æ–º) (3x10 –Ω–∞ –Ω–æ–≥—É)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –û–±—Ä–∞—Ç–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç —Å—Ç—É–ª–∞ (3x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è —Å —Ä–µ–∑–∏–Ω–æ–π (3x8)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è '–ë–∞–±–æ—á–∫–∞' (3x15)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –†–∞—Å—Ç—è–∂–∫–∞ –≥—Ä—É–¥–Ω—ã—Ö –º—ã—à—Ü –≤ –ø—Ä–æ–µ–º–µ"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –í–µ–ª–æ—Ç—Ä–µ–Ω–∞–∂–µ—Ä (5 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª–µ–∂–∞ (3x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –≥–∞–Ω—Ç–µ–ª–µ–π (–ö—É–±–æ–∫) (3x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ (3x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ –Ω–∞ –±–∏—Ü–µ–ø—Å (3x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º (3x12)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –í–∏—Å –Ω–∞ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–µ (30 —Å–µ–∫)"
                    ]
                },
                "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": {
                    "–î–æ–º": [
                        "üî• FLOW: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ–ª–Ω—Ü—É (Yoga) (3 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –î–∂–∞–º–ø–∏–Ω–≥ –î–∂–µ–∫–∏ (40 —Å–µ–∫ —Ä–∞–±–æ—Ç–∞ / 20 –æ—Ç–¥—ã—Ö) x 5",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ë–µ—Ä–ø–∏ (–±–µ–∑ –æ—Ç–∂–∏–º–∞–Ω–∏—è) (30 —Å–µ–∫ —Ä–∞–±–æ—Ç–∞ / 30 –æ—Ç–¥—ã—Ö) x 5",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ë–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ç–µ–Ω—å—é (40 —Å–µ–∫ —Ä–∞–±–æ—Ç–∞ / 20 –æ—Ç–¥—ã—Ö) x 5",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä—ã–∂–∫–∏ –Ω–∞ –º–µ—Å—Ç–µ (1 –º–∏–Ω —Ä–∞–±–æ—Ç–∞ / 30 –æ—Ç–¥—ã—Ö) x 3",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ê–ª—å–ø–∏–Ω–∏—Å—Ç (40 —Å–µ–∫ —Ä–∞–±–æ—Ç–∞ / 20 –æ—Ç–¥—ã—Ö) x 5",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ì–ª—É–±–æ–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ (2 –º–∏–Ω)"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (—à–∞–≥ –≤ –≥–æ—Ä—É) (5 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –¢—Ä–∞—Å—Ç–µ—Ä—ã —Å –ª–µ–≥–∫–∏–º–∏ –≥–∞–Ω—Ç–µ–ª—è–º–∏ (4x15)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ú–∞—Ö–∏ –≥–∏—Ä–µ–π (—Ä—É—Å—Å–∫–∏–π —Å—Ç–∏–ª—å) (4x15)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä—ã–∂–∫–∏ –Ω–∞ —Ç—É–º–±—É (–∏–ª–∏ –∑–∞—à–∞–≥–∏–≤–∞–Ω–∏—è) (4x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ë—ë—Ä–ø–∏ —Å –ø—Ä—ã–∂–∫–æ–º (4x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ì—Ä–µ–±–Ω–æ–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä (500–º –Ω–∞ –≤—Ä–µ–º—è)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ú–§–† —Ä–æ–ª–ª –Ω–∞ —Å–ø–∏–Ω—É (3 –º–∏–Ω)"
                    ]
                }
            },
            "–°—Ä–µ–¥–Ω–∏–π": {
                "–ü–æ—Ö—É–¥–µ–Ω–∏–µ": {
                    "–î–æ–º": [
                        "üî• ACTIVATION: –Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç–∏–∫ (20 —Ä–∞–∑)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –≤—ã–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ–º (4x15)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –û—Ç–∂–∏–º–∞–Ω–∏—è —Å –∫–∞—Å–∞–Ω–∏–µ–º –ø–ª–µ—á–∞ (4x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –í—ã–ø–∞–¥—ã –≤ –ø—Ä—ã–∂–∫–µ (3x12 –Ω–∞ –Ω–æ–≥—É)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–ª–∞–Ω–∫–∞-–ø–∞—É–∫ (3x45 —Å–µ–∫)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –†—É—Å—Å–∫–∏–µ —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏—è (3x20)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –†–∞—Å—Ç—è–∂–∫–∞ —è–≥–æ–¥–∏—Ü –ª–µ–∂–∞ (2 –º–∏–Ω)"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –°–∫–∞–∫–∞–ª–∫–∞ (3 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞ (4x8)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –Ω–∞–∫–ª–æ–Ω–Ω–æ–π —Å–∫–∞–º—å–µ (4x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è —à–∏—Ä–æ–∫–∏–º —Ö–≤–∞—Ç–æ–º (3xMAX)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ñ–∏–º –Ω–æ–≥–∞–º–∏ (4x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ú–ï–¢–ö–û–ù: 500–º –≥—Ä–µ–±–ª—è –Ω–∞ –≤—Ä–µ–º—è",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –†–∞—Å—Ç—è–∂–∫–∞ –∑–∞–¥–Ω–µ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –±–µ–¥—Ä–∞"
                    ]
                },
                "–ù–∞–±–æ—Ä –º—ã—à—Ü": {
                    "–î–æ–º": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∫–∞ (2 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –û—Ç–∂–∏–º–∞–Ω–∏—è –Ω–æ–≥–∏ –Ω–∞ –≤–æ–∑–≤—ã—à–µ–Ω–∏–∏ (4x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è –ø–∏—Å—Ç–æ–ª–µ—Ç–∏–∫ (—Å –æ–ø–æ—Ä–æ–π) (3x8)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –¢—è–≥–∞ –±—É—Ç—ã–ª–æ–∫ —Å –≤–æ–¥–æ–π/–≥–∞–Ω—Ç–µ–ª–µ–π –≤ –Ω–∞–∫–ª–æ–Ω–µ (4x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –û—Ç–∂–∏–º–∞–Ω–∏—è –¥–æ–º–∏–∫–æ–º (Pike pushups) (3x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–æ–¥—ä–µ–º –Ω–æ–≥ –≤ –≤–∏—Å–µ (3x15)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: '–ö–æ–±—Ä–∞' (—Ä–∞—Å—Ç—è–∂–∫–∞ –ø—Ä–µ—Å—Å–∞)"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –†–∞–∑–º–∏–Ω–∫–∞ —Ä–æ—Ç–∞—Ç–æ—Ä–Ω–æ–π –º–∞–Ω–∂–µ—Ç—ã (2 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π (5x5)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ê—Ä–º–µ–π—Å–∫–∏–π –∂–∏–º —Å—Ç–æ—è (4x8)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è —Å –≤–µ—Å–æ–º (4x6)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É (3x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ì–∏–ø–µ—Ä—ç–∫—Å—Ç–µ–Ω–∑–∏—è (3x15)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ú–§–† –∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å–æ–≤ (3 –º–∏–Ω)"
                    ]
                },
                "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": {
                    "–î–æ–º": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –ë–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ —Å –∑–∞—Ö–ª–µ—Å—Ç–æ–º (2 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: AMRAP 15 –º–∏–Ω (–ö–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ —Ä–∞—É–Ω–¥–æ–≤):",
                        "‚û°Ô∏è 20 –í—ã–ø–∞–¥–æ–≤",
                        "‚û°Ô∏è 15 –°–∏—Ç–∞–ø–æ–≤ (–ø—Ä–µ—Å—Å)",
                        "‚û°Ô∏è 10 –ë–µ—Ä–ø–∏",
                        "‚û°Ô∏è 5 –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π",
                        "‚û°Ô∏è 30 –°–∫–∞–∫–∞–ª–∫–∞",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ú–µ–¥–∏—Ç–∞—Ü–∏—è (3 –º–∏–Ω)"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: 1 –∫–º –ª–µ–≥–∫–∏–π –±–µ–≥",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞ (1 –º–∏–Ω —Å–ø—Ä–∏–Ω—Ç / 2 –º–∏–Ω —à–∞–≥) x 6",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ö—Ä—É–≥: –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è (5) -> –û—Ç–∂–∏–º–∞–Ω–∏—è (10) -> –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è (15) x 5",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ì—Ä–µ–±–Ω–æ–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä (2 –º–∏–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ) x 3",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –í–µ–ª–æ—Ç—Ä–µ–Ω–∞–∂–µ—Ä (5 –º–∏–Ω –≤—ã—Å–æ–∫–æ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ –≤—Å–µ–≥–æ —Ç–µ–ª–∞ (5 –º–∏–Ω)"
                    ]
                }
            },
            "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π": {
                "–ü–æ—Ö—É–¥–µ–Ω–∏–µ": {
                    "–î–æ–º": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –°–∫–∞–∫–∞–ª–∫–∞ –¥–≤–æ–π–Ω—ã–µ –ø—Ä—ã–∂–∫–∏ (2 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ë–µ—Ä–ø–∏ —Å –ø—Ä—ã–∂–∫–æ–º –≤ –¥–ª–∏–Ω—É (4x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –í–∑—Ä—ã–≤–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è (—Å —Ö–ª–æ–ø–∫–æ–º) (4x10)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –í—ã–ø–∞–¥—ã —Å–æ —Å–º–µ–Ω–æ–π –Ω–æ–≥ –≤ –ø—Ä—ã–∂–∫–µ (4x12 –Ω–∞ –Ω–æ–≥—É)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–ª–∞–Ω–∫–∞ —Å –∫–∞—Å–∞–Ω–∏–µ–º –ø–ª–µ—á (3x60 —Å–µ–∫)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–æ–¥—ä–µ–º—ã –∫–æ—Ä–ø—É—Å–∞ (4x20)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ô–æ–≥–∞ '–°–æ–±–∞–∫–∞ –º–æ—Ä–¥–æ–π –≤–Ω–∏–∑' (2 –º–∏–Ω)"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –≠–π—Ä–±–∞–π–∫ (Assault Bike) (3 –º–∏–Ω)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ö–û–ú–ü–õ–ï–ö–° 'BEAR': –í–∑—è—Ç–∏–µ –Ω–∞ –≥—Ä—É–¥—å + –§—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–π –ø—Ä–∏—Å–µ–¥ + –ñ–∏–º (5x5)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ó–∞–ø—Ä—ã–≥–∏–≤–∞–Ω–∏—è –Ω–∞ –∫–æ—Ä–æ–±–∫—É (4x15)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞ —Å—É–º–æ (4x8)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ì—Ä–µ–±–Ω–æ–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä (1000–º –Ω–∞ –≤—Ä–µ–º—è)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ë—ë—Ä–ø–∏ —Å –ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ —à—Ç–∞–Ω–≥—É (3x15)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ì–ª—É–±–æ–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ —Å —Ä–µ–∑–∏–Ω–æ–π"
                    ]
                },
                "–ù–∞–±–æ—Ä –º—ã—à—Ü": {
                    "–î–æ–º": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –ú–æ–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–ª–µ—á –∏ —Ç–∞–∑–∞",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –û—Ç–∂–∏–º–∞–Ω–∏—è –≤ —Å—Ç–æ–π–∫–µ –Ω–∞ —Ä—É–∫–∞—Ö (—É —Å—Ç–µ–Ω—ã) (4xMAX)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–π —Ä—É–∫–µ (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è) (4x3)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è '–ö—Ä–µ–≤–µ—Ç–∫–∞' (4x8)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –û—Ç–∂–∏–º–∞–Ω–∏—è –Ω–∞ –±—Ä—É—Å—å—è—Ö (4x12)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü–æ–¥—ä–µ–º—ã –Ω–æ–≥ –∫ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–µ (4x10)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —à–µ–∏ –∏ —Ç—Ä–∞–ø–µ—Ü–∏–∏"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: 500–º –≥—Ä–µ–±–ª—è",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞ (–∫–ª–∞—Å—Å–∏–∫–∞) (5x3)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ñ–∏–º –ª–µ–∂–∞ —Å –ø–∞—É–∑–æ–π (5x5)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π –Ω–∞ –≥—Ä—É–¥–∏ (4x6)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –¢—è–≥–∞ –¢-–≥—Ä–∏—Ñ–∞ (4x8)",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –°—É–ø–µ—Ä—Å–µ—Ç –ë–∏—Ü–µ–ø—Å/–¢—Ä–∏—Ü–µ–ø—Å (4x12)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –í–∏—Å –≤–Ω–∏–∑ –≥–æ–ª–æ–≤–æ–π (–∏–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–π —Å—Ç–æ–ª)"
                    ]
                },
                "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": {
                    "–î–æ–º": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –°—É—Å—Ç–∞–≤–Ω–∞—è 3 –º–∏–Ω",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: CHALLENGE '100':",
                        "‚û°Ô∏è 100 –ü—Ä–∏—Å–µ–¥–∞–Ω–∏–π",
                        "‚û°Ô∏è 100 –û—Ç–∂–∏–º–∞–Ω–∏–π",
                        "‚û°Ô∏è 100 –ü—Ä–µ—Å—Å",
                        "‚û°Ô∏è 100 –ë–µ—Ä–ø–∏ (—Ä–∞–∑–±–∏—Ç—å –Ω–∞ –ø–æ–¥—Ö–æ–¥—ã)",
                        "‚û°Ô∏è 100 –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π",
                        "‚û°Ô∏è 100 –í—ã–ø–∞–¥–æ–≤",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ü–æ–ª–Ω–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ (–®–∞–≤–∞—Å–∞–Ω–∞)"
                    ],
                    "–ó–∞–ª": [
                        "üî• –†–ê–ó–ú–ò–ù–ö–ê: –ë–µ–≥ 10 –º–∏–Ω",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: CROSSFIT WOD 'MURPH' (–ê–¥–∞–ø—Ç–∞—Ü–∏—è):",
                        "‚û°Ô∏è 800–º –±–µ–≥",
                        "‚û°Ô∏è 50 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π",
                        "‚û°Ô∏è 100 –æ—Ç–∂–∏–º–∞–Ω–∏–π",
                        "‚û°Ô∏è 150 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π",
                        "‚û°Ô∏è 800–º –±–µ–≥",
                        "‚ö° –û–°–ù–û–í–ù–ê–Ø –¢–†–ï–ù–ò–†–û–í–ö–ê: –≠–π—Ä–±–∞–π–∫ (5 –º–∏–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É—Å–∏–ª–∏–µ)",
                        "üßò –ó–ê–ú–ò–ù–ö–ê: –ú–§–† –≤—Å–µ–≥–æ —Ç–µ–ª–∞"
                    ]
                }
            }
        }
        
    def get_exercises(self, condition, level, goal):
        return self.exercises.get(level, {}).get(goal, {}).get(condition, None)
    
    def save_training_plan(self, user_id, level, goal, condition):
        session = self.Session()
        new_plan = TrainingPlan(user_id=user_id, level=level, goal=goal, condition=condition)
        session.add(new_plan)
        session.commit()
        session.close()
    
    def save_user_plan(self, user_id, plan_name, level, goal, condition, exercises):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–ª–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è."""
        session = self.Session()
        saved_plan = SavedPlan(
            user_id=user_id,
            plan_name=plan_name,
            level=level,
            goal=goal,
            condition=condition,
            exercises=json.dumps(exercises)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ JSON —Å—Ç—Ä–æ–∫—É
        )
        session.add(saved_plan)
        session.commit()
        session.close()
        return saved_plan.id
    
    def get_user_plans(self, user_id):
        """–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        session = self.Session()
        plans = session.query(SavedPlan).filter_by(user_id=user_id).order_by(SavedPlan.created_at.desc()).all()
        session.close()
        
        result = []
        for plan in plans:
            result.append({
                "id": plan.id,
                "name": plan.plan_name,
                "date": plan.created_at.strftime("%Y-%m-%d"),
                "level": plan.level,
                "goal": plan.goal,
                "condition": plan.condition,
                "exercises": json.loads(plan.exercises)
            })
        return result
    
    def save_workout_history(self, user_id, workout_name, exercises, duration):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏."""
        session = self.Session()
        history = WorkoutHistory(
            user_id=user_id,
            workout_name=workout_name,
            exercises=json.dumps(exercises),
            duration=duration
        )
        session.add(history)
        session.commit()
        session.close()
        return history.id
    
    def get_workout_history(self, user_id):
        """–ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        session = self.Session()
        history = session.query(WorkoutHistory).filter_by(user_id=user_id).order_by(WorkoutHistory.completed_at.desc()).all()
        session.close()
        
        result = []
        for record in history:
            result.append({
                "id": record.id,
                "workout_name": record.workout_name,
                "exercises": json.loads(record.exercises),
                "duration": record.duration,
                "completed_at": record.completed_at.strftime("%Y-%m-%d %H:%M")
            })
        return result
    
    def get_saved_plan_by_id(self, plan_id, user_id):
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –ø–æ ID."""
        session = self.Session()
        plan = session.query(SavedPlan).filter_by(id=plan_id, user_id=user_id).first()
        session.close()
        
        if plan:
            return {
                "id": plan.id,
                "name": plan.plan_name,
                "date": plan.created_at.strftime("%Y-%m-%d"),
                "level": plan.level,
                "goal": plan.goal,
                "condition": plan.condition,
                "exercises": json.loads(plan.exercises)
            }
        return None